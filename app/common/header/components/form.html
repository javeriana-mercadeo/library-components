<script src="https://www.javeriana.edu.co/recursosdb/1372208/10609114/vueprod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<style>
  /* Form Content - CSS usando variables globales del proyecto con fallbacks */

  /* Form Content Grid system */
  .fc-row {
    display: flex;
    flex-wrap: wrap;
    margin-left: calc(var(--spacing-xs, 0.5rem) * -1);
    margin-right: calc(var(--spacing-xs, 0.5rem) * -1);
  }

  .fc-col-md-6 {
    flex: 0 0 100%;
    max-width: 100%;
    padding-left: var(--spacing-xs, 0.5rem);
    padding-right: var(--spacing-xs, 0.5rem);
  }

  @media (min-width: 768px) {
    .fc-col-md-6 {
      flex: 0 0 50%;
      max-width: 50%;
    }
  }

  .fc-col-6 {
    flex: 0 0 50%;
    max-width: 50%;
    padding-left: var(--spacing-xs, 0.5rem);
    padding-right: var(--spacing-xs, 0.5rem);
  }

  /* Form Content Styles */
  .fc-form-control {
    display: block;
    width: 100%;
    height: calc(1.5em + var(--spacing-sm, 0.75rem) + 2px);
    padding: var(--spacing-xs, 0.5rem) var(--spacing-sm, 0.75rem);
    font-size: var(--font-size-paragraph, 1rem);
    line-height: 1.5;
    color: var(--neutral-200, #374151);
    background-color: var(--background-100, #ffffff);
    border: 1px solid var(--neutral-700, #d1d5db);
    border-radius: 4px;
    box-shadow: none;
    transition:
      border-color var(--transition, 0.3s) ease-in-out,
      box-shadow var(--transition, 0.3s) ease-in-out;
    box-sizing: border-box;
  }

  .fc-form-control:focus {
    border-color: var(--primary, #4a90e2);
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
  }

  .fc-form-control::placeholder {
    color: var(--neutral-500, #9ca3af);
    opacity: 1;
  }

  .fc-mb-3 {
    margin-bottom: var(--spacing-md, 1rem);
  }

  /* Form Content Text utilities */
  .fc-text-center {
    text-align: center;
  }

  .fc-text-primary {
    color: var(--primary, #4a90e2);
    text-decoration: none;
    transition: color var(--transition, 0.3s) ease-in-out;
  }

  .fc-text-primary:hover {
    color: var(--primary-dark, #3a7bc8);
    text-decoration: underline;
  }

  .fc-text-danger {
    color: var(--error, #dc3545);
  }

  .fc-text-neutral {
    color: var(--neutral-200, #374151);
  }

  .fc-small {
    font-size: 0.875rem;
  }

  /* Form Content validation */
  .fc-invalid-feedback {
    display: block;
    color: var(--error, #dc3545);
    font-size: 0.875rem;
    margin-top: var(--spacing-2xs, 0.25rem);
  }

  .fc-is-invalid {
    border-color: var(--error, #dc3545);
  }

  .fc-is-invalid:focus {
    border-color: var(--error, #dc3545);
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
  }

  /* Form check (radio/checkbox) */
  .fc-form-check {
    position: relative;
    display: block;
    padding-left: var(--spacing-lg, 1.5rem);
    margin-bottom: var(--spacing-sm, 0.75rem);
  }

  .fc-form-check-inline {
    display: inline-flex;
    align-items: center;
    padding-left: 0;
    margin-right: var(--spacing-xl, 2rem);
    margin-bottom: 0;
  }

  .fc-form-check-input {
    position: relative;
    margin-top: 0.125rem;
    margin-left: calc(var(--spacing-lg, 1.5rem) * -1);
    width: 1rem;
    height: 1rem;
    cursor: pointer;
    accent-color: var(--primary, #4a90e2);
    background-color: var(--background-100, #ffffff);
    border: 2px solid var(--neutral-700, #d1d5db);
    transition: all var(--transition, 0.3s) ease-in-out;
  }

  .fc-form-check-input:checked {
    background-color: var(--primary, #4a90e2);
    border-color: var(--primary, #4a90e2);
  }

  .fc-form-check-input:focus {
    outline: 0;
    box-shadow: 0 0 0 0.2rem rgba(74, 144, 226, 0.25);
    border-color: var(--primary, #4a90e2);
  }

  .fc-form-check-inline .fc-form-check-input {
    margin-left: 0;
    margin-right: var(--spacing-xs, 0.5rem);
  }

  .fc-form-check-label {
    margin-bottom: 0;
    font-size: 0.9rem;
    line-height: 1.25rem;
    cursor: pointer;
    color: var(--neutral-200, #374151);
    user-select: none;
  }

  /* Spacing utilities */
  .fc-mt-2 {
    margin-top: var(--spacing-xs, 0.5rem);
  }

  .fc-mt-4 {
    margin-top: var(--spacing-lg, 1.5rem);
  }

  .fc-mb-0 {
    margin-bottom: 0;
  }

  .fc-mb-2 {
    margin-bottom: var(--spacing-xs, 0.5rem);
  }

  .fc-mb-3 {
    margin-bottom: var(--spacing-md, 1rem);
  }

  .fc-p-3 {
    padding: var(--spacing-md, 1rem);
  }

  .fc-p-4 {
    padding: var(--spacing-lg, 1.5rem);
  }

  /* List styles */
  .fc-list-group {
    display: flex;
    flex-direction: column;
    padding-left: 0;
    margin-bottom: 0;
    border-radius: var(--border-radius-lg, 0.5rem);
  }

  .fc-list-group-item {
    position: relative;
    display: block;
    padding: var(--spacing-sm, 0.75rem) var(--spacing-md, 1rem);
    background-color: var(--background-100, #ffffff);
    border: 1px solid var(--neutral-700, #d1d5db);
    border-bottom: none;
  }

  .fc-list-group-item:first-child {
    border-top-left-radius: var(--border-radius-lg, 0.5rem);
    border-top-right-radius: var(--border-radius-lg, 0.5rem);
  }

  .fc-list-group-item:last-child {
    border-bottom: 1px solid var(--neutral-700, #d1d5db);
    border-bottom-left-radius: var(--border-radius-lg, 0.5rem);
    border-bottom-right-radius: var(--border-radius-lg, 0.5rem);
  }

  .fc-list-group-item-action {
    color: var(--neutral-400, #9ca3af);
    text-align: inherit;
    transition: all var(--transition, 0.3s) ease-in-out;
  }

  .fc-list-group-item-action:hover {
    background-color: var(--neutral-900, #f9fafb);
    color: var(--neutral-200, #1a1a1a);
  }

  /* Form specific styles */
  .fc-needs-validation {
    /* No additional styles needed, validation handled by Vue */
  }

  .wpcf7-response-output {
    border: 2px solid #28a745;
    background-color: #f8f9fa;
    padding: var(--spacing-md, 1rem);
    border-radius: var(--border-radius-lg, 0.5rem);
    margin-top: var(--spacing-md, 1rem);
  }
</style>

<div id="app" class="fc-modal-container">
  <div class="fc-modal-content">
    <div class="fc-modal-form">
      <form
        id="form_SF"
        ref="form_SF"
        v-on:submit.prevent="validateForm"
        action="https://webto.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8"
        method="POST"
        novalidate=""
        aria-label="Formulario de contacto"
        class="fc-needs-validation">
        <input type="hidden" name="oid" value="00Df4000003l8Bf" />
        <input type="hidden" name="retURL" id="retURL" value="https://www.javeriana.edu.co/info-prg/thank-you-pregrado" />
        <input type="hidden" name="debug" value="0" />
        <input type="hidden" name="debugEmail" value="" />

        <!-- Campos hidden para nombre y fecha del evento -->
        <input type="hidden" name="00NJw000006f1BF" :value="data.nevento" />
        <input type="hidden" name="00NJw000006f1BE" :value="data.fevento" />

        <div class="fc-row">
          <div class="fc-col-md-6 fc-mb-3">
            <input
              placeholder="*Nombre(s)"
              id="first_name"
              v-model="data.first_name"
              maxlength="40"
              v-on:change="deleteInvalid('first_name')"
              name="first_name"
              type="text"
              class="fc-form-control"
              :class="{ 'fc-is-invalid': errors.first_name }"
              required="" />
            <div class="fc-invalid-feedback" v-show="errors.first_name">Completa este campo</div>
          </div>

          <div class="fc-col-md-6 fc-mb-3">
            <input
              placeholder="*Apellidos"
              id="last_name"
              v-model="data.last_name"
              v-on:change="deleteInvalid('last_name')"
              maxlength="80"
              name="last_name"
              type="text"
              required=""
              class="fc-form-control"
              :class="{ 'fc-is-invalid': errors.last_name }" />
            <div class="fc-invalid-feedback" v-show="errors.last_name">Completa este campo</div>
          </div>
        </div>

        <div class="fc-row">
          <div class="fc-col-md-6 fc-mb-3">
            <select
              id="00N5G00000WmhsT"
              v-model="data.tipo_doc"
              v-on:change="deleteInvalid('tipo_doc')"
              name="00N5G00000WmhsT"
              required=""
              class="fc-form-control"
              :class="{ 'fc-is-invalid': errors.tipo_doc }">
              <option value="">*Tipo de documento</option>
              <option value="CC">Cédula Ciudadanía</option>
              <option value="CE">Cédula Extranjería</option>
              <option value="PA">Pasaporte</option>
              <option value="TI">Tarjeta Identidad</option>
            </select>
            <div class="fc-invalid-feedback" v-show="errors.tipo_doc">Selecciona</div>
          </div>

          <div class="fc-col-md-6 fc-mb-3">
            <input
              placeholder="*Número de documento"
              v-on:change="deleteInvalid('numero_doc')"
              v-model="data.numero_doc"
              id="00N5G00000WmhsR"
              maxlength="255"
              name="00N5G00000WmhsR"
              type="text"
              required=""
              class="fc-form-control"
              :class="{ 'fc-is-invalid': errors.numero_doc }" />
            <div class="fc-invalid-feedback" v-show="errors.numero_doc">Completa este campo</div>
          </div>
        </div>
        <div class="fc-mb-3">
          <input
            placeholder="*Email"
            id="email"
            v-model="data.email"
            v-on:change="deleteInvalid('email')"
            maxlength="80"
            name="email"
            type="email"
            required=""
            class="fc-form-control"
            :class="{ 'fc-is-invalid': errors.email }" />
          <div class="fc-invalid-feedback" v-show="errors.email">Ingresa un correo válido</div>
        </div>

        <div class="fc-row">
          <div class="fc-col-md-6 fc-mb-3">
            <select
              id="00NJw000002mzb7"
              name="00NJw000002mzb7"
              class="fc-form-control"
              v-model="data.prefijoCel"
              v-on:change="deleteInvalid('prefijoCel')"
              :class="{ 'fc-is-invalid': errors.prefijoCel }"
              required="">
              <option
                v-for="pais in prefijoCel"
                :value="pais.phoneCode"
                v-bind:style="{ backgroundColor: pais.phoneName === 'Colombia' ? 'aliceBlue' : '', color: pais.phoneName === 'Colombia' ? '#000000' : '', fontWeight: pais.phoneName === 'Colombia' ? '900' : '' }"
                v-bind:selected="pais.phoneName === 'Colombia'">
                (+{{ pais.phoneCode }}) {{ pais.phoneName }}
              </option>
            </select>
            <div class="fc-invalid-feedback" v-show="errors.prefijoCel">*Seleccione</div>
          </div>

          <div class="fc-col-md-6 fc-mb-3">
            <input
              placeholder="*Teléfono celular"
              id="mobile"
              v-model="data.mobile"
              v-on:change="deleteInvalid('mobile')"
              name="mobile"
              type="text"
              minlength="8"
              maxlength="15"
              required=""
              class="fc-form-control"
              :class="{ 'fc-is-invalid': errors.mobile }" />
            <div class="fc-invalid-feedback" v-show="errors.mobile">*Campo obligatorio (entre 8 y 10 caracteres)</div>
          </div>
        </div>

        <div class="fc-mb-3">
          <select
            v-model="data.pais"
            v-on:change="deleteInvalid('pais')"
            class="fc-form-control"
            id="00N5G00000WmhvJ"
            name="00N5G00000WmhvJ"
            required=""
            :class="{ 'fc-is-invalid': errors.pais }">
            <option value="">*País de residencia</option>
            <option v-for="(item, index) in ubicaciones" v-bind:value="index" v-bind:style="(index=='COL') ? 'font-weight: 700;' : '' ">
              {{ item.nombre }}
            </option>
          </select>
          <div class="fc-invalid-feedback" v-show="errors.pais">Selecciona</div>
        </div>

        <div class="fc-mb-3" v-if="data.pais=='COL'">
          <select
            v-model="data.departamento"
            v-on:change="deleteInvalid('departamento')"
            id="00N5G00000WmhvX"
            name="00N5G00000WmhvX"
            class="fc-form-control"
            :class="{ 'fc-is-invalid': errors.departamento }">
            <option value="">*Selecciona el departamento</option>
            <option v-for="(item, index) in ubicaciones[data.pais]?.departamentos || []" v-bind:value="item.codigo">
              {{ item.nombre }}
            </option>
          </select>
          <div class="fc-invalid-feedback" v-show="errors.departamento">Selecciona</div>
        </div>

        <div class="fc-mb-3" v-if="data.pais=='COL' &amp;&amp; data.departamento!=''">
          <select
            v-model="data.ciudad"
            v-on:change="deleteInvalid('ciudad')"
            id="00N5G00000WmhvO"
            name="00N5G00000WmhvO"
            class="fc-form-control"
            :class="{ 'fc-is-invalid': errors.ciudad }"
            v-bind:required="data.pais=='COL'">
            <option value="">*Selecciona la Ciudad</option>
            <option v-for="(item, index) in getCiudades(data.departamento)" v-bind:value="item.codigo">{{ item.nombre }}</option>
          </select>
          <div class="fc-invalid-feedback" v-show="errors.ciudad">Selecciona</div>
        </div>

        <!-- Campo oculto para tipo de asistente -->
        <input type="hidden" name="00NJw000001J3g6" value="Aspirante" />

        <input
          type="hidden"
          name="00N5G00000WmhvV"
          value="NOAP"
          v-if="data.tipo_asistente=='Padre de familia y/o acudiente' || data.tipo_asistente=='Visitante PUJ' || data.tipo_asistente=='Administrativo PUJ' || data.tipo_asistente=='Docente y/o psicoorientador'" />

        <!-- Campo oculto para programa académico (código SAE) -->
        <input type="hidden" name="00N5G00000WmhvV" :value="codeSAE" />

        <!-- Periodo esperado para aspirantes -->
        <div class="fc-mb-3">
          <select
            v-model="data.periodo_esperado"
            v-on:change="deleteInvalid('periodo_esperado')"
            name="00N5G00000WmhvI"
            id="00N5G00000WmhvI"
            class="fc-form-control"
            :class="{ 'fc-is-invalid': errors.periodo_esperado }">
            <option value="">*Periodo esperado de Ingreso</option>
            <option v-for="(index, item) in periodoSel" v-bind:value="index" :key="index">{{ item }}</option>
          </select>
          <div class="fc-invalid-feedback" v-show="errors.periodo_esperado">Selecciona</div>
        </div>

        <!-- para ocultar-->
        <div style="display: none">
          <div class="form-row">
            Origen de la Solicitud:<select
              id="00NJw000001J3Hl"
              name="00NJw000001J3Hl"
              v-model="data.origen_sol"
              title="Origen de la Solicitud">
              <option selected="" value="Web to Lead">Web to Lead</option>
            </select>

            Fuente autorización datos personales:<select
              id="00N5G00000WmhvT"
              name="00N5G00000WmhvT"
              v-model="data.fuenteAutoriza"
              title="Fuente autorización datos personales">
              <option value="Landing Eventos">Landing Eventos</option>
            </select>
            <label for="lead_source">Origen del candidato</label>
            <select id="lead_source" v-model="data.lead" name="lead_source">
              <option value="Landing Pages">Landing Pages</option>
            </select>
            <label for="company">Compañía</label
            ><input id="company" v-model="data.company" maxlength="40" name="company" size="20" type="text" value="NA" />
          </div>

          <!--UTMS-->
          <div class="form-row">
            Fuente:<input id="00N5G00000WmhvW" v-model="data.fuente" name="00N5G00000WmhvW" title="Fuente" type="text" /> Subfuente:<input
              id="00N5G00000WmhvZ"
              v-model="data.subfuente"
              name="00N5G00000WmhvZ"
              title="Subfuente"
              type="text" />
            Medio
            <input id="00NJw000001J3g8" v-model="data.medio" name="00NJw000001J3g8" title="Medio" type="text" />
            Articulo:<input
              id="00NJw000006f1BB"
              v-model="data.articulo"
              maxlength="255"
              title="Articulo"
              name="00NJw000006f1BB"
              type="text" />
            Campaña:<input id="00N5G00000Wmi8x" v-model="data.campana" maxlength="255" name="00N5G00000Wmi8x" type="text" />
          </div>
        </div>

        <div class="fc-mb-3">
          <p class="fc-mb-2 fc-text-neutral">
            ¿Autoriza el tratamiento de sus datos personales de acuerdo con la
            <a
              href="https://www.javeriana.edu.co/recursosdb/20125/12161151/politica-de-proteccion-de-datos-personales-universidad-javeriana.pdf"
              target="_blank"
              class="fc-text-primary"
              >autorización de privacidad</a
            >?
          </p>
          <div class="fc-form-check fc-form-check-inline">
            <input
              v-on:change="validateAutoriza()"
              class="fc-form-check-input"
              type="radio"
              v-model="data.autoriza"
              id="autoriza_si"
              name="00N5G00000WmhvF"
              value="1" />
            <label class="fc-form-check-label" for="autoriza_si">Sí</label>
          </div>
          <div class="fc-form-check fc-form-check-inline">
            <input
              v-on:change="validateAutoriza()"
              class="fc-form-check-input"
              type="radio"
              v-model="data.autoriza"
              name="00N5G00000WmhvF"
              id="autoriza_no"
              value="0" />
            <label class="fc-form-check-label" for="autoriza_no">No</label>
          </div>
          <div class="fc-text-danger fc-small fc-mt-2" v-show="errors.autoriza">
            La Pontificia Universidad Javeriana requiere de su autorización para el tratamiento de sus datos personales para continuar con
            el presente proceso
          </div>
        </div>

        <button
          id="boton_enviar2"
          class="btn btn-primary btn-solid btn-lg btn-full-width"
          type="submit"
          v-bind:disabled="formInValid || isSubmitting">
          <span class="btn-text">Inscríbete</span>
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  const { createApp } = Vue

  const app = createApp({
    data() {
      return {
        prefijoCel: [],
        programas: [],
        periodos: [],
        ubicaciones: [],
        periodoSel: [],
        codeSAE: '',
        formInValid: true,
        isSubmitting: false,
        data: {
          nevento: '',
          fevento: '',
          first_name: '',
          last_name: '',
          tipo_doc: '',
          numero_doc: '',
          email: '',
          mobile: '',
          prefijoCel: '57',
          pais: '',
          departamento: '',
          ciudad: '',
          tipo_asistente: 'Aspirante',
          periodo_esperado: '',
          origen_sol: 'Web to Lead',
          fuenteAutoriza: 'Landing Eventos',
          lead: 'Landing Pages',
          company: 'NA',
          fuente: 'Javeriana',
          subfuente: 'Organico',
          medio: 'Landing',
          articulo: 'Articulo',
          campana: '',
          autoriza: '',
          programNoap: ''
        },
        errors: {
          nevento: false,
          fevento: false,
          first_name: false,
          last_name: false,
          tipo_doc: false,
          numero_doc: false,
          email: false,
          mobile: false,
          prefijoCel: false,
          pais: false,
          departamento: false,
          ciudad: false,
          tipo_asistente: false,
          periodo_esperado: false,
          origen_sol: false,
          fuenteAutoriza: false,
          lead: false,
          company: false,
          fuente: false,
          subfuente: false,
          medio: false,
          articulo: false,
          campana: false,
          autoriza: false
        }
      }
    },
    watch: {
      'data.mobile': function (newMobile, oldMobile) {
        this.data.mobile = this.limpiarNumeros(newMobile)
      },
      'data.email': function (newEmail, oldEmail) {
        const regex =
          /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
        if (regex.test(newEmail) === false) {
          this.errors.email = true
        } else {
          this.errors.email = false
        }
      },
      // Watcher general para campos importantes
      'data.first_name': function () {
        this.updateFormValid()
      },
      'data.last_name': function () {
        this.updateFormValid()
      },
      'data.email': function () {
        this.updateFormValid()
      },
      'data.mobile': function () {
        this.updateFormValid()
      },
      'data.tipo_doc': function () {
        this.updateFormValid()
      },
      'data.numero_doc': function () {
        this.updateFormValid()
      },
      'data.pais': function () {
        this.updateFormValid()
      },
      'data.prefijoCel': function () {
        this.updateFormValid()
      },
      'data.departamento': function () {
        this.updateFormValid()
      },
      'data.ciudad': function () {
        this.updateFormValid()
      },
      'data.periodo_esperado': function () {
        this.updateFormValid()
      },
      // Watcher para cargar períodos cuando se obtienen los datos
      periodos: function (newPeriodos) {
        if (newPeriodos && newPeriodos['PREG']) {
          this.periodoSel = newPeriodos['PREG']
        }
      }
    },
    mounted() {
      // Recien carga el sitio se cargan los datos
      this.limpiarDatos()
      this.getUbicaciones()
      this.getPeriodos()
      this.getProgramas()
      this.getParametersGet()
      this.getPrefijoCel()

      // Asegurar que el estado del formulario se actualice inicialmente
      this.$nextTick(() => {
        this.updateFormValid()
      })

      // Escuchar el evento data_load-program para obtener el código SAE
      document.addEventListener('data_load-program', event => {
        this.codeSAE = event.detail.dataProgram.codPrograma
        this.data.campana = event.detail.dataProgram.codPrograma
      })

      // Cargar períodos de pregrado automáticamente
      this.$nextTick(() => {
        if (this.periodos && this.periodos['PREG']) {
          this.periodoSel = this.periodos['PREG']
        }
      })
    },
    methods: {
      /**
       * Funcion para limpiar la variable de los datos
       **/
      limpiarDatos() {
        this.data = {
          nevento: '',
          fevento: '',
          first_name: '',
          last_name: '',
          tipo_doc: '',
          numero_doc: '',
          email: '',
          mobile: '',
          prefijoCel: '57',
          pais: '',
          departamento: '',
          ciudad: '',
          tipo_asistente: 'Aspirante',
          periodo_esperado: '',
          origen_sol: 'Web to Lead',
          fuenteAutoriza: 'Landing Eventos',
          lead: 'Landing Pages',
          company: 'NA',
          fuente: 'Javeriana',
          subfuente: 'Organico',
          medio: 'Landing',
          articulo: '',
          campana: '',
          autoriza: '',
          programNoap: ''
        }
      },
      /**
       * Funcion para obtener los valores de los parametros que vienen por GET
       **/
      getParametersGet() {
        let urlParams = new URLSearchParams(window.location.search)
        this.data.fuente = urlParams.has('utm_source') ? urlParams.get('utm_source') : this.data.fuente
        this.data.subfuente = urlParams.has('utm_subsource') ? urlParams.get('utm_subsource') : this.data.subfuente
        this.data.medio = urlParams.has('utm_medium') ? urlParams.get('utm_medium') : this.data.medio
        this.data.campana = urlParams.has('utm_campaign') ? urlParams.get('utm_campaign') : this.data.campana
        this.data.articulo = urlParams.has('utm_article') ? urlParams.get('utm_article') : this.data.articulo
        this.data.fevento = urlParams.has('fevento') ? urlParams.get('fevento') : this.data.fevento
        this.data.nevento = urlParams.has('nevento') ? urlParams.get('nevento') : this.data.nevento
      },
      /**
       * Funcion para cargar los programas
       **/
      getProgramas() {
        axios
          //.get("/Json/programas.json")
          .get('https://www.javeriana.edu.co/recursosdb/1372208/10609114/programas.json')
          .then(response => {
            this.programas = response.data
          })
          .catch(function (error) {
            console.log(error)
          })
      },
      /**
       * Funcion para cargar los periodos
       **/
      getPeriodos() {
        axios
          //.get("/Json/periodos.json")
          .get('https://www.javeriana.edu.co/recursosdb/1372208/10609114/periodos.json')
          .then(response => {
            this.periodos = response.data
          })
          .catch(function (error) {
            console.log('Error loading periodos:', error)
          })
      },
      /**
       * Funcion para cargar las ubicaciones
       **/
      getUbicaciones() {
        axios
          //.get("/Json/ubicaciones.json")
          .get('https://www.javeriana.edu.co/recursosdb/1372208/10609114/ubicaciones.json')
          .then(response => {
            this.ubicaciones = response.data

            // Obtener la lista de departamentos
            this.departments = this.ubicaciones.COL.departamentos
              .map(departamento => ({
                nombre: departamento.nombre,
                codigo: departamento.codigo
              }))
              .sort((a, b) => a.nombre.localeCompare(b.nombre))

            // Trigger Vue reactivity update after departments are loaded
            this.$nextTick(() => {
              console.log('Vue nextTick after departments loaded - departments:', this.departments.length)
            })
          })
          .catch(function (error) {
            console.log('Error loading ubicaciones:', error)
          })
      },
      /**
       * Funcion para obtener las ciudades del departamento seleccionado
       **/
      getCiudades(departamento) {
        let departamentoSel = this.ubicaciones['COL'].departamentos.filter(res => {
          return res.codigo == departamento
        })
        return departamentoSel[0].ciudades
      },
      getPrefijoCel() {
        axios
          //.get("/Json/codigos_pais.json")
          .get('https://www.javeriana.edu.co/recursosdb/1372208/10609114/codigos_pais.json')
          .then(response => {
            // Filtrar los datos para obtener solo los códigos de país y sus prefijos
            this.prefijoCel = response.data.map(pais => {
              return {
                iso2: pais.iso2,
                phoneCode: pais.phoneCode,
                phoneName: pais.nameES
              }
            })
          })
      },

      /*colegios*/
      loadColegios(nivelAcademico) {
        let url
        if (nivelAcademico === 'GRAD') {
          //url = "/JSON/universidades.json";
          url = 'https://www.javeriana.edu.co/recursosdb/1372208/10609114/universidades.json'
        } else {
          //url = "/JSON/Colegios PRD.json";
          url = 'https://www.javeriana.edu.co/recursosdb/1372208/10609114/Colegios+PRD.json'
        }
        axios
          .get(url)
          .then(response => {
            this.colegios = response.data.cuentasInstitucionales
            this.filterColegios()
          })
          .catch(error => {
            console.error('Error al cargar los colegios:', error)
          })
      },
      selectColegio(externalId, nombreColegio) {
        this.data.colegio = externalId // Asigna el valor del ID del colegio seleccionado
        this.searchTerm = nombreColegio // Actualiza el campo de búsqueda con el nombre del colegio seleccionado
        this.colegioSeleccionado = true // Marca que se ha seleccionado un colegio
        this.errors.colegio = false // Limpia el error si es necesario

        // Trigger form validation update
        this.updateFormValid()
      },

      // Método para filtrar ciudades según el departamento seleccionado
      filterCities() {
        try {
          // Encuentra el departamento seleccionado
          const selectedDep = this.ubicaciones.COL.departamentos.find(dep => dep.codigo === this.selectedDepartment)

          if (selectedDep) {
            // Filtra las ciudades que tienen colegios
            const ciudadesConColegios = new Set(this.colegios.map(colegio => colegio.SHIPPINGCITY))

            // Solo muestra ciudades que pertenecen al departamento y tienen colegios
            this.cities = selectedDep.ciudades
              .filter(ciudad => ciudadesConColegios.has(ciudad.nombre))
              .sort((a, b) => a.nombre.localeCompare(b.nombre)) // Ordena las ciudades alfabéticamente

            // Resetea la ciudad seleccionada cuando cambia el departamento
            this.selectedCity = ''
          } else {
            this.cities = [] // Si no hay departamento seleccionado, resetea las ciudades
            this.selectedCity = ''
          }

          // Resetear el colegio seleccionado y limpiar la lista de colegios filtrados
          this.data.colegio = ''
          this.filteredColegios = []
          this.searchTerm = '' // Limpia el campo de búsqueda
          this.filterColegios() // Actualiza la lista de colegios
        } catch (error) {
          console.error('Error in filterCities:', error)
        }
      },

      // Método para filtrar colegios según la ciudad seleccionada o el término de búsqueda
      filterColegios() {
        // Si el campo de búsqueda está vacío, resetea el colegio seleccionado
        if (!this.searchTerm) {
          this.data.colegio = ''
          this.colegioSeleccionado = false // Indica que no hay colegio seleccionado
        }

        // Log sample college structure for debugging
        if (this.colegios.length > 0) {
        }

        // Filtra los colegios según departamento, ciudad y el término de búsqueda
        this.filteredColegios = this.colegios
          .filter(colegio => {
            // Si hay ciudad seleccionada, filtrar por ciudad (ignora departamento)
            if (this.selectedCity) {
              const matchesCity = colegio.SHIPPINGCITY === this.selectedCity
              const matchesSearch = colegio.NAME.toLowerCase().includes(this.searchTerm.toLowerCase())

              // Log para debugging de ciudad (solo los primeros 3)
              if (this.filteredColegios.length < 3) {
                console.log('City filter check:', {
                  collegeName: colegio.NAME,
                  collegeCity: colegio.SHIPPINGCITY,
                  selectedCity: this.selectedCity,
                  matchesCity,
                  matchesSearch,
                  passes: matchesCity && matchesSearch
                })
              }

              return matchesCity && matchesSearch
            }

            // Si hay departamento pero no ciudad, filtrar por departamento
            if (this.selectedDepartment) {
              const matchesDepartment = colegio.SHIPPINGSTATE === this.selectedDepartment
              const matchesSearch = colegio.NAME.toLowerCase().includes(this.searchTerm.toLowerCase())
              return matchesDepartment && matchesSearch
            }

            // Si solo hay término de búsqueda, buscar en todos los colegios
            const matchesSearch = colegio.NAME.toLowerCase().includes(this.searchTerm.toLowerCase())
            return matchesSearch
          })
          .sort((a, b) => a.NAME.localeCompare(b.NAME)) // Ordena los colegios alfabéticamente

        if (this.filteredColegios.length === 0) {
          this.data.colegio = ''
        }
      },

      /**
       * Funcion para validar si esta el campo de aceptar terminos
       **/
      validateAutoriza() {
        if (this.data.autoriza == '1') {
          this.errors.autoriza = false
        } else if (this.data.autoriza == '0') {
          this.errors.autoriza = true
        }
        // Actualizar el estado del formulario
        this.updateFormValid()
      },
      /**
       * Función para actualizar el estado de validación del formulario
       **/
      updateFormValid() {
        // Solo habilitar si todos los campos son válidos Y se ha autorizado el tratamiento de datos
        console.log('updateFormValid called, autoriza value:', this.data.autoriza, 'type:', typeof this.data.autoriza)
        if (this.data.autoriza == '1') {
          this.formInValid = false
          console.log('Form validation result:', !this.formInValid, 'formInValid:', this.formInValid)
        } else {
          this.formInValid = true
          console.log('Form invalid - no authorization, autoriza:', this.data.autoriza)
        }
      },
      /**
       * Función para verificar si todos los campos son válidos (sin actualizar errores)
       **/
      checkAllFieldsValid() {
        // Verificar campos requeridos básicos
        const basicFields = [
          'first_name',
          'last_name',
          'tipo_doc',
          'numero_doc',
          'email',
          'mobile',
          'prefijoCel',
          'pais',
          'periodo_esperado'
        ]
        for (let field of basicFields) {
          if (!this.data[field] || this.data[field] === '') {
            return false
          }
        }

        // Verificar email válido
        const emailRegex =
          /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
        if (!emailRegex.test(this.data.email)) {
          return false
        }

        // Verificar mobile válido
        if (this.data.mobile.length < 8) {
          return false
        }

        // Si es de Colombia, verificar departamento y ciudad
        if (this.data.pais === 'COL') {
          if (!this.data.departamento || !this.data.ciudad) {
            return false
          }
        }

        return true
      },
      /**
       * Funcion para limpiar textos
       **/
      limpiarTexto(texto) {
        let textolimpio = texto.replace(/[^a-zA-Záéíóúñ ]/g, '')
        return textolimpio
      },
      /**
       * Funcion para limpiar numeros
       **/
      limpiarNumeros(numero) {
        let textolimpio = numero.replace(/[^0-9 ]/g, '')
        return textolimpio
      },
      /**
       * Funcion para limpiar json
       **/
      limpiarJson(texto) {
        return texto
          .replaceAll('|', '')
          .replace(/(\r\n|\n|\r)/gm, '')
          .replace(/['"]+/g, "'")
          .trim()
      },
      /**
       * Funcion para limpiar alfanumericos
       **/
      limpiarAlfanumerico(text) {
        let textolimpio = text.replace(/[^a-zA-Z0-9- ]/g, '')
        return textolimpio
      },
      /**
       * Funcion para validar que los campos tengan datos
       **/
      validateInputs() {
        let valid = true
        let keys = Object.keys(this.data)
        keys.forEach(element => {
          this.errors[element] = false
          switch (element) {
            case 'first_name':
            case 'last_name':
            case 'tipo_doc':
            case 'numero_doc':
            case 'pais':
            case 'prefijoCel':
            case 'tipo_asistente':
              if (this.data[element] == '' || this.data[element] == null) {
                valid = false
                this.errors[element] = true
              }
              break
            case 'departamento':
            case 'ciudad':
              if ((this.data[element] == '' || this.data[element] == null) && this.data.pais == 'COL') {
                valid = false
                this.errors[element] = true
              }
              break
            case 'email':
              const regex =
                /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|.(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
              if (this.data[element] == '' || this.data[element] == null) {
                valid = false
                this.errors[element] = true
              } else if (regex.test(this.data[element]) === false) {
                valid = false
                this.errors[element] = true
              }
              break
            case 'mobile':
              if (this.data[element] == '' || this.data[element] == null || this.data[element].length < 8) {
                valid = false
                this.errors[element] = true
              }
              break
            case 'periodo_esperado':
              if (this.data[element] == '' || this.data[element] == null) {
                valid = false
                this.errors[element] = true
              }
              break
            case 'universidad':
              // La universidad se valida a través del campo colegio para GRAD
              // No se requiere validación separada ya que se usa el campo colegio
              break
            case 'autoriza':
              if (this.data[element] != '1') {
                valid = false
                this.errors[element] = true
              }
              break

            default:
              break
          }
        })
        return valid
      },
      /**
       * Funcion para enviar el formulario
       **/
      validateForm: function (e) {
        console.log('formInValid:', this.formInValid)
        console.log('autoriza value:', this.data.autoriza)

        const validationResult = this.validateInputs()
        console.log('validateInputs result:', validationResult)
        console.log('Current errors:', this.errors)

        if (!validationResult) {
          console.log('Validation failed - preventing form submit')
          e.preventDefault()
          return false
        } else {
          console.log('Validation passed - submitting form')
          this.isSubmitting = true
          this.$refs.form_SF.submit()
        }
      },
      /**
       * Funcion para limpiar en caso que sea invalido
       **/
      deleteInvalid(campo) {
        this.errors[campo] = false
        // Actualizar el estado del formulario cuando se corrige un campo
        this.updateFormValid()
      }
    }
  })

  const vueApp = app.mount('#app')

  // Event delegation para colegios (backup para Vue events que no funcionan)
  document.addEventListener('click', function (e) {
    // Verificar si el click fue en un elemento de colegio
    const collegeItem = e.target.closest('.fc-list-group-item-action')
    if (collegeItem && collegeItem.closest('.fc-list-group')) {
      const collegeName = collegeItem.textContent.trim()

      // Buscar el colegio en filteredColegios para obtener el ID
      if (vueApp && vueApp.filteredColegios) {
        const selectedCollege = vueApp.filteredColegios.find(c => c.NAME === collegeName)
        if (selectedCollege) {
          vueApp.selectColegio(selectedCollege.PUJ_EXTERNALORGID__C, selectedCollege.NAME)
        }
      }
    }
  })
</script>
