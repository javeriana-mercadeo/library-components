@use 'sass:map';
@use 'sass:meta';
@use '@styles/autoload' as *;

@mixin caption {
  // Clase base común para todos los captions
  .caption {
    display: block;
    margin: 0;
    font-family: var(--font-family);
    line-height: 1.4;
    transition: all 0.2s ease-in-out;

    // ==========================================
    // TAMAÑOS DE CAPTION
    // ==========================================
    &.caption-xs {
      font-size: var(--font-size-xs);
      margin-bottom: rem(4px);
    }

    &.caption-sm {
      font-size: var(--font-size-small);
      margin-bottom: rem(6px);
    }

    &.caption-md {
      font-size: var(--font-size-paragraph);
      margin-bottom: rem(8px);
    }

    &.caption-lg {
      font-size: var(--font-size-caption);
      margin-bottom: rem(10px);
    }

    &.caption-xl {
      font-size: var(--font-size-subtitle);
      margin-bottom: rem(12px);
    }

    // ==========================================
    // ALINEACIONES
    // ==========================================
    &.caption-left {
      text-align: left;
    }

    &.caption-center {
      text-align: center;
    }

    &.caption-right {
      text-align: right;
    }

    // ==========================================
    // ELEMENTOS INTERNOS COMUNES
    // ==========================================
    strong {
      font-weight: var(--font-weight-bold);
    }

    em {
      font-style: italic;
    }

    // Enlaces dentro del caption
    a {
      color: inherit;
      text-decoration: underline;
      text-underline-offset: rem(2px);
      transition: opacity 0.2s ease;

      &:hover {
        opacity: 0.8;
      }

      &:focus {
        outline: rem(2px) solid currentColor;
        outline-offset: rem(2px);
        border-radius: rem(2px);
      }
    }

    // ==========================================
    // ESTADOS ESPECIALES
    // ==========================================
    // Caption clickeable (si se usa con onClick)
    &.caption-clickable {
      cursor: pointer;
      transition: all 0.2s ease;

      &:hover {
        opacity: 0.8;
        transform: translateY(rem(-1px));
      }

      &:active {
        transform: translateY(0);
      }

      &:focus {
        outline: rem(2px) solid currentColor;
        outline-offset: rem(2px);
        border-radius: rem(2px);
      }
    }

    // Caption con truncado
    &.caption-truncate {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    // Caption con múltiples líneas (line-clamp)
    &.caption-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    &.caption-clamp-3 {
      display: -webkit-box;
      -webkit-line-clamp: 3;
      line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  }

  // ==========================================
  // MODIFICADORES DE TEXTO - ALTA ESPECIFICIDAD
  // ==========================================
  // IMPORTANTE: Estos deben ir DESPUÉS de los estilos de color/variante
  // para tener mayor especificidad

  .caption {
    // Modificadores con !important para asegurar que no se sobrescriban
    &.caption-uppercase {
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
    }

    &.caption-italic {
      font-style: italic !important;
    }

    &.caption-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    // ==========================================
    // COMBINACIONES DE MODIFICADORES
    // ==========================================
    // Italic + Bold
    &.caption-italic.caption-bold {
      font-style: italic !important;
      font-weight: var(--font-weight-bold) !important;
    }

    // Uppercase + Bold
    &.caption-uppercase.caption-bold {
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      font-weight: var(--font-weight-bold) !important;
    }

    // Uppercase + Italic
    &.caption-uppercase.caption-italic {
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      font-style: italic !important;
    }

    // Triple combinación
    &.caption-uppercase.caption-italic.caption-bold {
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      font-style: italic !important;
      font-weight: var(--font-weight-bold) !important;
    }
  }

  // ==========================================
  // VARIACIONES ESPECIALES PARA NEUTRAL
  // ==========================================
  .caption-neutral {
    // Variante default - solo texto sin contenedor
    &.caption-default {
      color: var(--neutral-500);
      background-color: transparent;
      padding: 0;
      border: none;
      border-radius: 0;
      font-weight: var(--font-weight-regular);

      // Preservar modificadores de texto
      &.caption-bold {
        font-weight: var(--font-weight-bold) !important;
      }

      &.caption-italic {
        font-style: italic !important;
      }

      &.caption-uppercase {
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
      }
    }

    // Sobrescribir estilos para neutral en cualquier tema
    &.caption-solid {
      color: var(--neutral-200);
      background-color: var(--neutral-800);
    }

    &.caption-outline {
      color: var(--neutral-400);
      border-color: var(--neutral-600);
    }

    &.caption-subtle {
      color: var(--neutral-500);
      background-color: var(--neutral-900);
    }

    &.caption-accent {
      color: var(--neutral-300);

      &::before {
        background: linear-gradient(90deg, var(--neutral-500), transparent);
      }
    }

    @include dark-theme {
      // Variante default en tema oscuro
      &.caption-default {
        color: var(--neutral-300);

        // Preservar modificadores en tema oscuro también
        &.caption-bold {
          font-weight: var(--font-weight-bold) !important;
        }

        &.caption-italic {
          font-style: italic !important;
        }

        &.caption-uppercase {
          text-transform: uppercase !important;
          letter-spacing: 0.05em !important;
        }
      }

      &.caption-solid {
        color: var(--neutral-200);
        background-color: var(--neutral-700);
      }

      &.caption-outline {
        color: var(--neutral-400);
        border-color: var(--neutral-500);
      }

      &.caption-subtle {
        color: var(--neutral-300);
        background-color: var(--neutral-800);
      }

      &.caption-accent {
        color: var(--neutral-200);

        &::before {
          background: linear-gradient(90deg, var(--neutral-400), transparent);
        }
      }
    }
  }

  // Aplicar los estilos temáticos a cada combinación de caption y color
  @include colors-variants('caption', meta.get-mixin('caption-theme-style'));
}

@mixin caption-theme-style($color-values, $color-name) {
  // Valores para modo claro
  $color-100: var(--#{$color-name}-100);
  $color-200: var(--#{$color-name}-200);
  $color-300: var(--#{$color-name}-300);
  $color-400: var(--#{$color-name}-400);
  $color-500: var(--#{$color-name}-500);
  $color-600: var(--#{$color-name}-600);
  $color-700: var(--#{$color-name}-700);
  $color-800: var(--#{$color-name}-800);
  $color-900: var(--#{$color-name}-900);
  $color-950: var(--#{$color-name}-950);
  $color-rgb: var(--#{$color-name}-rgb);

  // Estilo para variante default - solo texto sin contenedor
  &.caption-default {
    color: $color-600;
    background-color: transparent;
    padding: 0;
    border: none;
    border-radius: 0;
    font-weight: var(--font-weight-regular);

    // ⚡ IMPORTANTE: Preservar modificadores de texto
    &.caption-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    &.caption-italic {
      font-style: italic !important;
    }

    &.caption-uppercase {
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
    }
  }

  // Estilo para variante solid
  &.caption-solid {
    color: $color-600;
    background-color: $color-100;
    padding: rem(4px) rem(8px);
    border-radius: rem(4px);
    font-weight: var(--font-weight-medium);

    // Preservar modificadores
    &.caption-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    &.caption-italic {
      font-style: italic !important;
    }
  }

  // Estilo para variante outline
  &.caption-outline {
    color: $color-500;
    border: rem(1px) solid $color-500;
    background-color: transparent;
    padding: rem(3px) rem(7px);
    border-radius: rem(4px);
    font-weight: var(--font-weight-medium);

    // Preservar modificadores
    &.caption-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    &.caption-italic {
      font-style: italic !important;
    }
  }

  // Estilo para variante subtle
  &.caption-subtle {
    color: $color-600;
    background-color: $color-100;
    padding: rem(2px) rem(6px);
    border-radius: rem(3px);
    font-weight: var(--font-weight-regular);
    opacity: 0.9;

    // Preservar modificadores
    &.caption-bold {
      font-weight: var(--font-weight-bold) !important;
    }

    &.caption-italic {
      font-style: italic !important;
    }
  }

  // Estilo para variante accent
  &.caption-accent {
    color: $color-700;
    position: relative;
    font-weight: var(--font-weight-bold);

    &::before {
      content: '';
      position: absolute;
      bottom: rem(-2px);
      left: 0;
      width: 100%;
      height: rem(2px);
      background: linear-gradient(90deg, $color-600, transparent);
      border-radius: rem(1px);
    }

    // Preservar modificadores (accent ya es bold por defecto)
    &.caption-italic {
      font-style: italic !important;
    }
  }

  @include dark-theme {
    // Preservar modificadores en tema oscuro también
    &.caption-default {
      color: $color-500;

      &.caption-bold {
        font-weight: var(--font-weight-bold) !important;
      }

      &.caption-italic {
        font-style: italic !important;
      }

      &.caption-uppercase {
        text-transform: uppercase !important;
        letter-spacing: 0.05em !important;
      }
    }

    &.caption-solid {
      color: $color-500;
      background-color: $color-900;

      &.caption-bold {
        font-weight: var(--font-weight-bold) !important;
      }

      &.caption-italic {
        font-style: italic !important;
      }
    }

    &.caption-outline {
      color: $color-400;
      border-color: $color-400;

      &.caption-bold {
        font-weight: var(--font-weight-bold) !important;
      }

      &.caption-italic {
        font-style: italic !important;
      }
    }

    &.caption-subtle {
      color: $color-300;
      background-color: $color-950;

      &.caption-bold {
        font-weight: var(--font-weight-bold) !important;
      }

      &.caption-italic {
        font-style: italic !important;
      }
    }

    &.caption-accent {
      color: $color-200;

      &::before {
        background: linear-gradient(90deg, $color-300, transparent);
      }

      &.caption-italic {
        font-style: italic !important;
      }
    }
  }
}
